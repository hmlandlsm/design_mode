<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <title></title>
</head>

<body></body>

</html>
<script>
    console.log('aaaaaaaaaaaaaaaaaaaaa')
    // 自己瞎写的
    // const upload = function () {
    //     let time = Math.round(Math.random() * 500 + 100)
    //     return new Promise((resolve, reject) => {
    //         console.log(`run ${time}ms`);
    //         if (Math.random() > 0.5) {
    //             setTimeout(resolve, time, 'promise resolved ' + time + 'ms');
    //         } else {
    //             setTimeout(reject, time, 'promise rejected ' + time + 'ms');
    //         }
    //     })
    // };
    // (async () => {
    //     try {
    //         let res = await Promise.race([upload(), upload(), upload()])
    //         console.log(res)
    //     } catch (err) {
    //         console.log(err)
    //     }
    // })();

    // 文档例子
    // const upload = function (blob) {
    //     let time = Math.round(100 + 500 * Math.random());
    //     return new Promise((resolve, reject) => {
    //         // 是否执行测试
    //         console.log(`run ${time}ms`);
    //         // 成功失败概率50%
    //         if (Math.random() > 0.5) {
    //             setTimeout(resolve, time, 'promise resolved ' + time + 'ms');
    //         } else {
    //             setTimeout(reject, time, 'promise rejected ' + time + 'ms');
    //         }
    //     });
    // };
    // const load = function (url) {
    //     // 同upload
    // };
    // (async () => {
    //     try {
    //         let result = await Promise.all([upload(0), upload(1), upload(2)]);
    //         console.log(result);
    //     } catch (err) {
    //         console.error(err);
    //     }
    // })();


    // loading时间显示需要
    // let getUserInfo = function (user) {
    //     return new Promise((resolve, reject) => {
    //         setTimeout(() => resolve('姓名：张鑫旭'), Math.floor(400 * Math.random() + 2000));
    //     });
    // }

    // let showUserInfo = function (user) {
    //     return getUserInfo().then(info => {
    //         console.log('用户信息', info);
    //         return true;
    //     });
    // }

    // let timeout = function (delay, result) {
    //     return new Promise(resolve => {
    //         setTimeout(() => resolve(result), delay);
    //     });
    // }
    // let time = 0;
    // let showToast = function () {
    //     time = +new Date()
    //     console.log('show loading...');
    // }
    // let hideToast = function () {
    //     ;
    //     console.log('hide loading' + (+new Date() - time));
    // }
    // // 执行代码示意
    // let promiseUserInfo = showUserInfo();
    // Promise.race([promiseUserInfo, timeout(2000)]).then((display) => {
    //     if (!display) {
    //         showToast();

    //         Promise.all([promiseUserInfo, timeout(2000)]).then(() => {
    //             hideToast();
    //         });
    //     }
    // });







    // promise.race例子
    function timeout(delay) {
        let cancel;
        const wait = new Promise(resolve => {
            const timer = setTimeout(() => resolve(false), delay);
            
            cancel = () => {
                clearTimeout(timer);
                resolve(true);
            };
        });
        wait.cancel = cancel;
        return wait;
    }

    function doWork() {
        const workFactor = Math.floor(600 * Math.random());
        const work = timeout(workFactor);

        const result = work.then(canceled => {
            if (canceled)
                console.log('Work canceled');
            else
                console.log('Work done in', workFactor, 'ms');
            return !canceled;
        });
        result.cancel = work.cancel;
        return result;
    }

    function attemptWork() {
        const work = doWork();
        return Promise.race([work, timeout(300)])
            .then(done => {
                if (!done) work.cancel();
                return (done ? 'Work complete!' : 'I gave up');
            });
    }

    attemptWork().then(console.log);















    /***
     * 总结：
     * 1、await Promise.all([fn1, fn2, fn3]),参数传的是数组
     * 2、setTimeout函数：
     * 参数1：到点后执行的代码块
     * 参数2：延迟多久执行
     * 参数3,4,5...:作为参数1的参数。。绝了都
     * 3、自我执行函数
     * (() => {})()
     * 4、Math.round()：四舍五入
     * 5、all和race都会全部执行，all所有为通过才是resolve，race是返回第一个结果，resolve或者reject
     *
     *
     */

     
</script>